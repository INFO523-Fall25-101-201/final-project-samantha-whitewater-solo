import streamlit as st
import pandas as pd

st.title("Diabetes Prediction Dashboard by Samantha Whitewater")
st.markdown("### Results Visualization: Ensemble Methods with SMOTE")

#pre-calculated results from analysis
baseline_results = {
    'Random Forest': {'Accuracy': 0.753, 'Precision': 0.630, 'Recall': 0.630},
    'Gradient Boosting': {'Accuracy': 0.753, 'Precision': 0.629, 'Recall': 0.648},
    'AdaBoost': {'Accuracy': 0.779, 'Precision': 0.676, 'Recall': 0.648}
}

smote_results = {
    'Random Forest': {'Accuracy': 0.740, 'Precision': 0.600, 'Recall': 0.667},
    'Gradient Boosting': {'Accuracy': 0.792, 'Precision': 0.659, 'Recall': 0.704},
    'AdaBoost': {'Accuracy': 0.740, 'Precision': 0.595, 'Recall': 0.685}
}

dataset_info = {
    'Total Patients': 768,
    'No Diabetes': 500,
    'Diabetes': 268,
    'Percent with Diabetes': 34.9
}

feature_importance = {
    'Glucose': 0.2589,
    'BMI': 0.1385,
    'Age': 0.1191,
    'DiabetesPedigreeFunction': 0.1143,
    'BloodPressure': 0.0984,
    'Insulin': 0.0948,
    'Pregnancies': 0.0921,
    'SkinThickness': 0.0839
}

page = st.sidebar.radio("Page", ["Dataset", "Model Results", "Key Findings"])

if page == "Dataset":
    st.header("Dataset Overview")
    
    col1, col2, col3, col4 = st.columns(4)
    with col1:
        st.metric("Total Patients", dataset_info['Total Patients'])
    with col2:
        st.metric("No Diabetes", dataset_info['No Diabetes'])
    with col3:
        st.metric("Diabetes", dataset_info['Diabetes'])
    with col4:
        st.metric("% Diabetic", f"{dataset_info['Percent with Diabetes']:.1f}%")
    
    st.subheader("About the Data")
    st.write("""
    **Source**: Pima Indians Diabetes Database
    
    **Features**:
    - Pregnancies
    - Glucose Level
    - Blood Pressure
    - Skin Thickness
    - Insulin Level
    - BMI (Body Mass Index)
    - Diabetes Pedigree Function
    - Age
    
    **Target**: Diabetes outcome (0 = No, 1 = Yes)
    """)
    
    st.subheader("Class Imbalance")
    st.write(f"""
    The dataset shows class imbalance with {dataset_info['No Diabetes']} non-diabetic patients 
    vs {dataset_info['Diabetes']} diabetic patients. This is why SMOTE was applied to improve 
    model performance on the minority class.
    """)

elif page == "Model Results":
    st.header("Model Performance Comparison")
    
    st.subheader("Baseline Models (Without SMOTE)")
    baseline_df = pd.DataFrame(baseline_results).T
    st.dataframe(baseline_df)
    
    st.markdown("**Best Baseline**: AdaBoost with 77.9% accuracy and 64.8% recall")
    
    st.markdown("---")
    
    st.subheader("SMOTE Models")
    smote_df = pd.DataFrame(smote_results).T
    st.dataframe(smote_df)
    
    st.markdown("**Best with SMOTE**: Gradient Boosting with 79.2% accuracy and 70.4% recall")
    
    st.markdown("---")
    
    st.subheader("Impact of SMOTE")
    
    col1, col2 = st.columns(2)
    with col1:
        st.metric("Accuracy Improvement", "+1.3%", 
                 help="Gradient Boosting: 75.3% → 79.2%")
    with col2:
        st.metric("Recall Improvement", "+5.6%", 
                 help="Gradient Boosting: 64.8% → 70.4%")
    
    st.success("""
    SMOTE improved recall across all models, meaning better detection of diabetic patients.
    
    Gradient Boosting became the top performer after SMOTE application.
    """)

else:  # Key Findings
    st.header("Key Findings")
    
    st.subheader("Feature Importance")
    st.write("Most important predictors from Gradient Boosting model:")
    
    importance_df = pd.DataFrame({
        'Feature': feature_importance.keys(),
        'Importance': feature_importance.values()
    }).sort_values('Importance', ascending=False)
    
    st.dataframe(importance_df)
    
    st.info(f"""
    **Top 3 Features**:
    1. **Glucose** ({feature_importance['Glucose']:.4f}) - Over 2x more important than other features
    2. **BMI** ({feature_importance['BMI']:.4f})
    3. **Age** ({feature_importance['Age']:.4f})
    
    This aligns with medical knowledge about diabetes risk factors.
    """)
    
    st.markdown("---")
    
    st.subheader("Summary")
    
    st.write("""
    **Research Question 1**: Which ensemble method performs best?
    - **Baseline**: AdaBoost (77.9% accuracy)
    - **With SMOTE**: Gradient Boosting (79.2% accuracy, 70.4% recall)
    
    **Research Question 2**: How does SMOTE affect performance?
    - Improved recall across all models (better diabetes detection)
    - Gradient Boosting showed the most improvement
    - Recall increased from ~65% to ~70%
    
    **Limitations**:
    - Small dataset (768 patients)
    - Still misses ~30% of diabetes cases
    - Should be used as screening tool, not diagnostic replacement
    
    **Real-World Application**:
    The SMOTE-adjusted Gradient Boosting model shows promise for early diabetes screening, 
    particularly when combined with clinical judgment.
    """)

st.sidebar.markdown("---")
st.sidebar.info("""
**Project**: Predicting Diabetes Using Ensemble Methods & SMOTE

**Author**: Samantha Whitewater

**Models Compared**:
- Random Forest
- Gradient Boosting  
- AdaBoost

**Best Model**: Gradient Boosting with SMOTE
""")
